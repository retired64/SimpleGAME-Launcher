name: Build Pixel Launcher Pro

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build:
    name: Build on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}

    strategy:
      fail-fast: false
      matrix:
        os:
          - ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # PASO CRITICO: Instalar dependencias del sistema para GTK
      # PyGObject no compilar치 sin estas librer칤as presentes en Ubuntu
      - name: Install System Dependencies (GTK)
        run: |
          sudo apt-get update
          sudo apt-get install -y libgirepository1.0-dev gcc libcairo2-dev pkg-config python3-dev libgtk-3-dev

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyinstaller
          # Instalamos PyGObject expl칤citamente ya que tu c칩digo usa 'import gi'
          pip install pygobject
          # Si tienes un requirements.txt, descomenta la siguiente l칤nea:
          # pip install -r requirements.txt

      - name: Build with PyInstaller
        run: |
          # --windowed: Para que no abra una terminal negra al ejecutar
          # --onefile: Todo en un solo archivo
          # --hidden-import: Asegura que incluya las librer칤as de GTK
          pyinstaller --onefile --windowed --name PixelLauncherPro \
          --hidden-import="gi" \
          main.py

      - name: List built files
        run: |
          echo "Contents of dist directory:"
          ls -la dist/
          echo "Full path:"
          pwd
          file dist/PixelLauncherPro

      - name: Make binary executable
        run: chmod +x dist/PixelLauncherPro

      - name: Get version from tag
        id: get_version
        run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

      - name: Create Release
        uses: softprops/action-gh-release@v2
        with:
          # Esto detecta autom치ticamente tu repositorio actual
          repository: ${{ github.repository }}
          tag_name: ${{ steps.get_version.outputs.VERSION }}
          name: Pixel Launcher Pro ${{ steps.get_version.outputs.VERSION }}
          body: |
            游 **Pixel Launcher Pro ${{ steps.get_version.outputs.VERSION }}**
            
            Gestor de juegos estilo Cyberpunk para Linux.
            
            ## Instalaci칩n
            1. Descarga el archivo `PixelLauncherPro`
            2. Dale permisos de ejecuci칩n: `chmod +x PixelLauncherPro`
            3. Ejec칰talo: `./PixelLauncherPro`
            
            ## Requisitos
            - Linux (Ubuntu/Debian/Fedora/Arch) con GTK 3 instalado.
          files: |
            dist/PixelLauncherPro
          token: ${{ secrets.GITHUB_TOKEN }}
          draft: false
